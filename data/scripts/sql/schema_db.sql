create or replace warehouse NUTRIRAG_PROJECT;

create or replace database NUTRIRAG_PROJECT;

create or replace TABLE INGREDIENTS_WITH_CLUSTERS (
	NDB_NO VARCHAR(16777216),
	DESCRIP VARCHAR(16777216),
	ENERGY_KCAL NUMBER(38,15),
	PROTEIN_G NUMBER(38,2),
	SATURATED_FATS_G NUMBER(38,16),
	FAT_G NUMBER(38,2),
	CARB_G NUMBER(38,2),
	FIBER_G NUMBER(38,2),
	SUGAR_G NUMBER(38,2),
	CALCIUM_MG NUMBER(38,16),
	IRON_MG NUMBER(38,3),
	MAGNESIUM_MG NUMBER(38,2),
	PHOSPHORUS_MG NUMBER(38,2),
	POTASSIUM_MG NUMBER(38,2),
	SODIUM_MG NUMBER(38,2),
	ZINC_MG NUMBER(38,2),
	COPPER_MCG NUMBER(38,16),
	MANGANESE_MG NUMBER(38,16),
	SELENIUM_MCG NUMBER(38,2),
	VITC_MG NUMBER(38,2),
	THIAMIN_MG NUMBER(38,16),
	RIBOFLAVIN_MG NUMBER(38,16),
	NIACIN_MG NUMBER(38,16),
	VITB6_MG NUMBER(38,16),
	FOLATE_MCG NUMBER(38,2),
	VITB12_MCG NUMBER(38,2),
	VITA_MCG NUMBER(38,2),
	VITE_MG NUMBER(38,2),
	VITD2_MCG NUMBER(38,0),
	CLUSTER_MICRO NUMBER(38,1),
	CLUSTER_MACRO NUMBER(38,1)
);
create or replace schema CLEANED;

create or replace TABLE INGREDIENTS_MATCHING (
	ID NUMBER(38,0),
	INGREDIENT VARCHAR(16777216),
	NDB_NO VARCHAR(16777216)
);
create or replace TABLE INGREDIENTS_TAGGED (
	NDB_NO VARCHAR(16777216),
	DESCRIP VARCHAR(16777216),
	FOODON_LABEL VARCHAR(16777216),
	IS_DAIRY BOOLEAN,
	IS_SEAFOOD BOOLEAN,
	IS_GLUTEN BOOLEAN,
	IS_VEGETABLE BOOLEAN,
	CONTAINS_NUTS BOOLEAN,
	IS_SWEETENER BOOLEAN,
	IS_VEGETARIAN BOOLEAN,
	IS_GRAIN BOOLEAN
);
create or replace TABLE RECIPES_SAMPLE_50K (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY,
	FILTERS ARRAY,
	NUTRISCORE ARRAY,
	SCORE_SANTE FLOAT
);
create or replace TABLE RECIPES_SAMPLE_50K_STR (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS VARCHAR(16777216),
	INGREDIENTS VARCHAR(16777216),
	NUTRITION VARCHAR(16777216),
	STEPS VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	N_INGREDIENTS NUMBER(38,0),
	N_STEPS NUMBER(38,0),
	CALORIES FLOAT,
	TOTAL_FAT FLOAT,
	SUGAR FLOAT,
	SODIUM FLOAT,
	PROTEIN FLOAT,
	SATURATED_FAT FLOAT,
	CARBS FLOAT
);
create or replace schema DEV_SAMPLE;

create or replace TABLE RECIPES_SAMPLE (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY,
	FILTERS ARRAY
);
create or replace TABLE RECIPES_SAMPLE_50K (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY,
	FILTERS ARRAY
);
create or replace TABLE RECIPES_SAMPLE_TEST (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS_TEXT VARCHAR(16777216),
	INGREDIENTS_TEXT VARCHAR(16777216),
	NUTRITION_TEXT VARCHAR(16777216),
	STEPS_TEXT VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	N_INGREDIENTS NUMBER(38,0),
	N_STEPS NUMBER(38,0),
	INGREDIENTS_ARRAY ARRAY,
	TEXT_SEARCH_RAG VARCHAR(16777216) AS (CONCAT(NAME, ' | ', TAGS_TEXT, ' | ', INGREDIENTS_TEXT, ' | ', STEPS_TEXT, ' | ', DESCRIPTION))
);
create or replace TABLE RECIPES_UNIFIED_EMBEDDINGS (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY,
	FILTERS ARRAY,
	EMBEDDING VECTOR(FLOAT, 768)
);
create or replace TABLE RECIPE_EMBEDDINGS (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS VARCHAR(16777216),
	INGREDIENTS VARCHAR(16777216),
	NUTRITION VARCHAR(16777216),
	STEPS VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	N_INGREDIENTS NUMBER(38,0),
	N_STEPS NUMBER(38,0),
	CALORIES FLOAT,
	TOTAL_FAT FLOAT,
	SUGAR FLOAT,
	SODIUM FLOAT,
	PROTEIN FLOAT,
	SATURATED_FAT FLOAT,
	CARBS FLOAT,
	TEXT_FOR_RAG VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 384)
);
create or replace TABLE RECIPE_EMBEDDINGS_50K (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY,
	FILTERS ARRAY,
	EMBEDDING VECTOR(FLOAT, 768)
);

create or replace schema ENRICHED;

create or replace authentication policy MY_AUTHENTICATION_POLICY AUTHENTICATION_METHODS=('ALL') CLIENT_TYPES=('ALL') CLIENT_POLICY=() SECURITY_INTEGRATIONS=('ALL') MFA_ENROLLMENT=REQUIRED MFA_POLICY=(ENFORCE_MFA_ON_EXTERNAL_AUTHENTICATION='NONE',ALLOWED_METHODS=('ALL')) PAT_POLICY=(DEFAULT_EXPIRY_IN_DAYS=15,NETWORK_POLICY_EVALUATION=ENFORCED_NOT_REQUIRED,MAX_EXPIRY_IN_DAYS=365) WORKLOAD_IDENTITY_POLICY=(ALLOWED_AWS_PARTITIONS=('ALL'),ALLOWED_OIDC_ISSUERS=('ALL'),ALLOWED_PROVIDERS=('ALL'),ALLOWED_AZURE_ISSUERS=('ALL'),ALLOWED_AWS_ACCOUNTS=('ALL')) ;

create or replace schema PUBLIC;

create or replace TABLE INGREDIENTSWITHCLUSTER (
	NDB_NO VARCHAR(16777216),
	DESCRIP VARCHAR(16777216),
	ENERGY_KCAL NUMBER(38,15),
	PROTEIN_G NUMBER(38,2),
	SATURATED_FATS_G NUMBER(38,16),
	FAT_G NUMBER(38,2),
	CARB_G NUMBER(38,2),
	FIBER_G NUMBER(38,2),
	SUGAR_G NUMBER(38,2),
	CALCIUM_MG NUMBER(38,16),
	IRON_MG NUMBER(38,3),
	MAGNESIUM_MG VARCHAR(16777216),
	PHOSPHORUS_MG NUMBER(38,2),
	POTASSIUM_MG NUMBER(38,2),
	SODIUM_MG NUMBER(38,2),
	ZINC_MG NUMBER(38,2),
	COPPER_MCG NUMBER(38,16),
	MANGANESE_MG NUMBER(38,16),
	SELENIUM_MCG NUMBER(38,2),
	VITC_MG NUMBER(38,2),
	THIAMIN_MG NUMBER(38,16),
	RIBOFLAVIN_MG NUMBER(38,16),
	NIACIN_MG NUMBER(38,16),
	VITB6_MG NUMBER(38,16),
	FOLATE_MCG NUMBER(38,2),
	VITB12_MCG NUMBER(38,2),
	VITA_MCG NUMBER(38,2),
	VITE_MG VARCHAR(16777216),
	VITD2_MCG VARCHAR(16777216),
	CLUSTER_MICRO NUMBER(38,0),
	CLUSTER_MACRO NUMBER(38,0)
);


create or replace schema RAW with managed access;

create or replace TABLE CLEANED_INGREDIENTS (
	NDB_NO VARCHAR(16777216),
	DESCRIP VARCHAR(16777216),
	ENERGY_KCAL NUMBER(38,15),
	PROTEIN_G NUMBER(38,2),
	SATURATED_FATS_G NUMBER(38,18),
	FAT_G NUMBER(38,2),
	CARB_G NUMBER(38,2),
	FIBER_G NUMBER(38,2),
	SUGAR_G NUMBER(38,2),
	CALCIUM_MG NUMBER(38,18),
	IRON_MG NUMBER(38,3),
	PHOSPHORUS_MG NUMBER(38,2),
	POTASSIUM_MG NUMBER(38,2),
	SODIUM_MG NUMBER(38,2),
	ZINC_MG NUMBER(38,2),
	COPPER_MCG NUMBER(38,18),
	MANGANESE_MG NUMBER(38,18),
	SELENIUM_MCG NUMBER(38,2),
	VITC_MG NUMBER(38,2),
	THIAMIN_MG NUMBER(38,18),
	RIBOFLAVIN_MG NUMBER(38,18),
	NIACIN_MG NUMBER(38,18),
	VITB6_MG NUMBER(38,18),
	FOLATE_MCG NUMBER(38,2),
	VITB12_MCG NUMBER(38,2),
	VITA_MCG NUMBER(38,2),
	MAGNESIUM_MG FLOAT,
	SCORE_SANTE FLOAT
);
create or replace TABLE INGREDIENTS_MATCHING (
	RECIPE_ID NUMBER(38,0),
	INGREDIENT_FROM_RECIPE_NAME VARCHAR(16777216),
	INGREDIENT_ID VARCHAR(16777216)
);
create or replace TABLE INGREDIENTS_QUANTITY (
	ID NUMBER(38,0),
	INGREDIENTS VARCHAR(16777216),
	QUANTITY_RAW_STR VARCHAR(16777216),
	QUANTITY NUMBER(38,3),
	UNIT VARCHAR(16777216),
	QTY_ML NUMBER(38,17),
	QTY_G NUMBER(38,17)
);
create or replace TABLE RAW_INTERACTION_10K (
	USER_ID NUMBER(38,0),
	RECIPE_ID NUMBER(38,0),
	DATE DATE,
	RATING NUMBER(38,0),
	REVIEW VARCHAR(16777216)
);
create or replace TABLE RAW_RECIPES_10K (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS VARCHAR(16777216),
	NUTRITION VARCHAR(16777216),
	N_STEPS NUMBER(38,0),
	STEPS VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS VARCHAR(16777216),
	N_INGREDIENTS NUMBER(38,0),
	FILTERS ARRAY
);
create or replace TABLE RAW_RECIPES_110K (
	NAME VARCHAR(16777216),
	ID NUMBER(38,0),
	MINUTES NUMBER(38,0),
	CONTRIBUTOR_ID NUMBER(38,0),
	SUBMITTED DATE,
	TAGS ARRAY,
	NUTRITION ARRAY,
	N_STEPS NUMBER(38,0),
	STEPS ARRAY,
	DESCRIPTION VARCHAR(16777216),
	INGREDIENTS ARRAY,
	N_INGREDIENTS NUMBER(38,0),
	HAS_IMAGE NUMBER(38,0),
	IMAGE_URL VARCHAR(16777216),
	INGREDIENTS_RAW_STR ARRAY,
	SERVING_SIZE NUMBER(38,0),
	SERVINGS NUMBER(38,0),
	SEARCH_TERMS ARRAY
);
create or replace schema VECTORS;

create or replace TABLE RECIPE_EMBEDDINGS (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 768)
);
create or replace TABLE RECIPE_EMBEDDINGS_E5_BASE_V2 (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 768)
);
create or replace TABLE RECIPE_EMBEDDINGS_NV_EMBED_QA_4 (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 1024)
);
create or replace TABLE RECIPE_EMBEDDINGS_SNOWFLAKE_ARCTIC_EMBED_M (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 768)
);
create or replace TABLE RECIPE_EMBEDDINGS_SNOWFLAKE_ARCTIC_EMBED_M_V1_5 (
	ID NUMBER(38,0),
	NAME VARCHAR(16777216),
	EMBEDDING VECTOR(FLOAT, 768)
);